<div class="dialog-container p-3 p-md-4">
  <h5 class="mb-4 text-center">إضافة / تعديل منتج</h5>

  <form [formGroup]="productForm">

    <div class="row g-3">
      <!-- Name (EN) -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-input">
          <input class="form-control" formControlName="nameEn" placeholder=" " />
          <label>الاسم بالانجليزي</label>
        </div>
      </div>

      <!-- Name (AR) -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-input">
          <input class="form-control" formControlName="nameAr" placeholder=" " />
          <label>الاسم بالعربي</label>
        </div>
      </div>

      <!-- Category -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-select">
          <select class="form-select" formControlName="subCategoryId">
            <option [ngValue]="null">-- Select --</option>
            <option *ngFor="let c of subCategories" [ngValue]="c.id">{{ c.nameAr }}</option>
          </select>
          <label>التصنيف</label>
        </div>
      </div>

      <!-- Unit -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-select">
          <select class="form-select" formControlName="unitId">
            <option [ngValue]="null">-- Select --</option>
            <option *ngFor="let u of units" [ngValue]="u.id">{{ u.nameAr }}</option>
          </select>
          <label>وحدة القياس</label>
        </div>
      </div>

      <!-- Code -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-input">
          <input class="form-control" formControlName="code" readonly placeholder=" " />
          <label>الكود</label>
        </div>
      </div>

      <!-- costPrice -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-input">
          <input type="number" class="form-control" formControlName="costPrice" placeholder=" " />
          <label>سعر الشراء</label>
        </div>
      </div>

      <!-- sellingPrice -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="floating-label-input">
          <input type="number" class="form-control" formControlName="sellingPrice" placeholder=" " />
          <label>سعر البيع</label>
        </div>
      </div>

      <!-- Is Active -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" formControlName="isActive" />
          <label class="form-check-label">الفعالية</label>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <!-- Description -->
      <div class="col-12 col-md-6">
        <div class="floating-label-textarea">
          <textarea class="form-control" rows="11" formControlName="description" placeholder=" "></textarea>
          <label>Description</label>
        </div>
      </div>

      <!-- Image Upload -->
      <div class="col-12 col-md-6">
        <app-image-uploader formControlName="image" [initialImageUrl]="initialImageUrl"
          (imageSelected)="detectFiles($event)"></app-image-uploader>
      </div>
    </div>

    <!-- Variants and Modifiers Section -->
    <div class="row g-3 mt-4" *ngIf="productForm.get('id')?.value > 0">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">إدارة المتغيرات والتعديلات</h5>
          </div>
          <div class="card-body">
            <!-- Product Variants -->
            <div class="mb-4">
              <h6>متغيرات المنتج</h6>
              <app-product-variants 
                [productId]="productForm.get('id')?.value" 
                (variantsUpdated)="onVariantsUpdated($event)">
              </app-product-variants>
            </div>

            <!-- Product Modifiers -->
            <div>
              <h6>تعديلات المنتج</h6>
              <app-product-modifiers 
                [productId]="productForm.get('id')?.value" 
                (modifiersUpdated)="onModifiersUpdated($event)">
              </app-product-modifiers>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="col-12 mt-4 d-flex justify-content-end gap-2 flex-wrap">
      <button class="btn btn-secondary flex-fill" (click)="cancel()">إلغاء</button>
      <button class="btn btn-primary flex-fill" (click)="save()" [disabled]="productForm.invalid">حفظ</button>
    </div>

  </form>
</div>