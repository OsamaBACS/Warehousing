<div class="modifier-management-container">
  <div class="header">
    <h3>Modifier Management</h3>
    <button class="btn btn-primary" (click)="resetModifierForm()" *ngIf="!isEditing">
      ‚ûï Add New Modifier
    </button>
  </div>

  <!-- Modifier Form -->
  <div class="modifier-form" *ngIf="isEditing || modifiers.length === 0 || showAddModifierForm">
    <form [formGroup]="modifierForm" (ngSubmit)="onModifierSubmit()">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="name">Modifier Name *</label>
            <input type="text" id="name" formControlName="name" class="form-control" placeholder="e.g., Size, Color, Toppings">
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="code">Modifier Code</label>
            <input type="text" id="code" formControlName="code" class="form-control" placeholder="e.g., SIZE, COLOR, TOPPINGS">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" formControlName="description" class="form-control" rows="2" placeholder="Optional description"></textarea>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label for="priceAdjustment">Price Adjustment</label>
            <input type="number" id="priceAdjustment" formControlName="priceAdjustment" class="form-control" step="0.01">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="costAdjustment">Cost Adjustment</label>
            <input type="number" id="costAdjustment" formControlName="costAdjustment" class="form-control" step="0.01">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="maxSelections">Max Selections</label>
            <input type="number" id="maxSelections" formControlName="maxSelections" class="form-control" min="1">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="displayOrder">Display Order</label>
            <input type="number" id="displayOrder" formControlName="displayOrder" class="form-control">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <div class="form-check">
              <input type="checkbox" id="isRequired" formControlName="isRequired" class="form-check-input">
              <label for="isRequired" class="form-check-label">Required</label>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <div class="form-check">
              <input type="checkbox" id="isMultiple" formControlName="isMultiple" class="form-check-input">
              <label for="isMultiple" class="form-check-label">Multiple Selection</label>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <div class="form-check">
              <input type="checkbox" id="isActive" formControlName="isActive" class="form-check-input">
              <label for="isActive" class="form-check-label">Active</label>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="modifierForm.invalid">
          üíæ {{ isEditing ? 'Update' : 'Create' }} Modifier
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
          ‚ùå Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Modifiers List -->
  <div class="modifiers-list" *ngIf="modifiers.length > 0">
    <h4>Available Modifiers</h4>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Name</th>
            <th>Code</th>
            <th>Type</th>
            <th>Max Selections</th>
            <th>Options</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let modifier of modifiers" (click)="selectModifier(modifier)" style="cursor: pointer;">
            <td>{{ modifier.name }}</td>
            <td>{{ modifier.code || '-' }}</td>
            <td>
              <span class="badge" [class.badge-info]="modifier.isMultiple" [class.badge-secondary]="!modifier.isMultiple">
                {{ modifier.isMultiple ? 'Multiple' : 'Single' }}
              </span>
            </td>
            <td>{{ modifier.maxSelections }}</td>
            <td>{{ modifier.options?.length || 0 }}</td>
            <td>
              <span class="badge" [class.badge-success]="modifier.isActive" [class.badge-danger]="!modifier.isActive">
                {{ modifier.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-primary me-2" (click)="editModifier(modifier); $event.stopPropagation()" title="Edit">
                ‚úèÔ∏è
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteModifier(modifier); $event.stopPropagation()" title="Delete">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Selected Modifier Options -->
  <div class="modifier-options" *ngIf="selectedModifier">
    <div class="options-header">
      <h4>{{ selectedModifier.name }} Options</h4>
      <button class="btn btn-sm btn-primary" (click)="resetOptionForm()" *ngIf="!isEditingOption">
        ‚ûï Add Option
      </button>
    </div>

    <!-- Option Form -->
    <div class="option-form" *ngIf="isEditingOption || (selectedModifier.options && selectedModifier.options.length === 0) || showAddOptionForm">
      <form [formGroup]="optionForm" (ngSubmit)="onOptionSubmit()">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="optionName">Option Name *</label>
              <input type="text" id="optionName" formControlName="name" class="form-control" placeholder="e.g., Small, Red, Extra Cheese">
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="optionCode">Option Code</label>
              <input type="text" id="optionCode" formControlName="code" class="form-control" placeholder="e.g., SMALL, RED, CHEESE">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="optionDescription">Description</label>
              <textarea id="optionDescription" formControlName="description" class="form-control" rows="2"></textarea>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-3">
            <div class="form-group">
              <label for="optionPriceAdjustment">Price Adjustment</label>
              <input type="number" id="optionPriceAdjustment" formControlName="priceAdjustment" class="form-control" step="0.01">
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label for="optionCostAdjustment">Cost Adjustment</label>
              <input type="number" id="optionCostAdjustment" formControlName="costAdjustment" class="form-control" step="0.01">
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label for="optionDisplayOrder">Display Order</label>
              <input type="number" id="optionDisplayOrder" formControlName="displayOrder" class="form-control">
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <div class="form-check">
                <input type="checkbox" id="optionIsDefault" formControlName="isDefault" class="form-check-input">
                <label for="optionIsDefault" class="form-check-label">Default</label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-success" [disabled]="optionForm.invalid">
            üíæ {{ isEditingOption ? 'Update' : 'Create' }} Option
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetOptionForm()">
            ‚ùå Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- Options List -->
    <div class="options-list" *ngIf="selectedModifier.options && selectedModifier.options.length > 0">
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Name</th>
              <th>Code</th>
              <th>Price Adjustment</th>
              <th>Default</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let option of selectedModifier.options">
              <td>{{ option.name }}</td>
              <td>{{ option.code || '-' }}</td>
              <td>{{ option.priceAdjustment | currency }}</td>
              <td>
                <span class="badge badge-info" *ngIf="option.isDefault">Default</span>
              </td>
              <td>
                <span class="badge" [class.badge-success]="option.isActive" [class.badge-danger]="!option.isActive">
                  {{ option.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-primary me-2" (click)="editModifierOption(option)" title="Edit">
                  ‚úèÔ∏è
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteModifierOption(option)" title="Delete">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && modifiers.length === 0 && !isEditing">
    <div class="text-center">
      ‚öôÔ∏è
      <h4>No Modifiers Found</h4>
      <p>Create your first modifier to get started. Modifiers can be reused across multiple products.</p>
    </div>
  </div>
</div>
